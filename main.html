<!DOCTYPE html>
	<html>
		<head><title> 1.3k pong </title></head>
<body onkeydown="keys[event.key] = true;" onkeyup="keys[event.key] = false">
	<div style="position:relative">
		<canvas id="main" width="800" height="600" style="position:absolute" ></canvas>
		<canvas id="overlay" width="800" height="600" style="position:absolute"></canvas>
	</div>
	<script type="text/javascript"> 
var ctx = document.getElementById("main").getContext("2d");
var ctx2 = document.getElementById("overlay").getContext("2d");
var w = 800, h = 600;

ctx2.strokeRect(0, 0, 20, 20);
var keys = {};
players = [
	{x: 30, y: 100, vx: 0, vy: 0, canJump: true, left: 'a', right: 'd', jump:'w', hit: ' '},
	{x: 60, y: 100, vx: 0, vy: 0, canJump: true, left: 'Left', right: 'Right', jump:'Up', hit: '0'}
]
var platforms = [{x1: 30, y1: 30, x2: 750, y2: 40},
				 {x1: 400, y1: 150, x2: 470, y2: 160}]
function clip(x, min, max){
	if(x < min) x = min;
	else if(x > max) x = max;
	return x;
}
function collide(r1, r2){
	if(r1.x1 < r2.x2 && r1.y1 < r2.y2 && r1.x2 > r2.x1 && r1.y2 > r2.y1){
		return true;
		console.log("collided");
	}
	console.log("didn't collide")
	return false;
}
function pTor(p){
	return {x1: p.x - 15, x2: p.x + 15, y1: p.y - 15, y2: p.y + 15};
}
function draw(){
	ctx.clearRect(0, 0, w, h);
	ctx.fillStyle = "blue";
	ctx.fillRect(players[0].x-15, h-players[0].y-15, 30, 30);
	ctx.fillStyle = "red";
	ctx.fillRect(players[1].x-15, h-players[1].y-15, 30, 30);
	ctx.fillStyle = "black";
	for(var i = platforms.length - 1; i >= 0; i--){
		ctx.fillRect(platforms[i].x1, h - platforms[i].y1, platforms[i].x2 - platforms[i].x1, -(platforms[i].y2 - platforms[i].y1));
	}
	
}
function handleInput(){
	for(var i = 0; i < 2; i++){
		if(keys[players[i].left]){
			if(players[i].vx > -5) players[i].vx -= 0.3;
		} else if(keys[players[i].right]){
			if(players[i].vx < 5) players[i].vx += 0.3;
		} else players[i].vx /= 1.1;
		if(keys[players[i].jump] && players[i].canJump){
			players[i].canJump = false;
			players[i].vy += 10;
		} else players[i].vy -= 0.3;
	}
}
function doLogic(){
	for(var i = 0; i < 2; i++){
		players[i].x += players[i].vx;
		players[i].y += players[i].vy;
		var pbox = pTor(players[i])
		for(var j = 0; j < platforms.length; j++){
			if(collide(platforms[j], pbox)){ // ground collision here
				if(players[i].vy <= 0){
					players[i].canJump = true;
					players[i].vy = 0;
				}
				players[i].y += platforms[j].y2 - pbox.y1;
			}
		}
	}
}
function loop(){
	window.requestAnimationFrame(loop);
	handleInput();
	doLogic();
	draw();
}
loop();
	</script>
	</body>
</html>
